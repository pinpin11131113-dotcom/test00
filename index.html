<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœˆä¸‹è€äºº - æœˆéœé…’å§</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <style>
        body { font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; background-color: #FFB74D; margin: 0; padding: 10px; color: #4E342E; }
        .container { max-width: 650px; margin: 10px auto; background-color: #FFF9F0; padding: 25px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); position: relative; }
        
        .logout-btn { position: absolute; top: 20px; right: 20px; background: #8D6E63; color: white; border: none; padding: 8px 15px; border-radius: 15px; cursor: pointer; font-size: 13px; z-index: 10; }
        h1 { color: #E64A19; text-align: center; font-size: 32px; margin-bottom: 5px; }
        h2 { border-left: 5px solid #E64A19; padding-left: 10px; color: #5D4037; font-size: 20px; margin-top: 35px; background: #FFECB3; padding: 5px; border-radius: 5px; }
        h3 { font-size: 16px; margin-top: 20px; color: #D84315; border-bottom: 1px dashed #FFCC80; padding-bottom: 5px; }

        .input-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 12px; border: 1.5px solid #FFCC80; border-radius: 12px; box-sizing: border-box; font-size: 16px; background: white; }
        textarea { min-height: 120px; }

        /* æ¨™ç±¤ */
        .tag-container { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
        .tag-checkbox { display: none; }
        .tag-label { display: inline-block; padding: 8px 16px; border: 1.5px solid #FFCC80; border-radius: 20px; background: #FFF; color: #5D4037; cursor: pointer; font-size: 13px; transition: 0.2s; }
        .tag-checkbox:checked + .tag-label { background: #FF8A80; color: white; border-color: #FF8A80; font-weight: bold; }
        .tag-checkbox:disabled + .tag-label { opacity: 0.4; cursor: not-allowed; background: #EEE; }

        .btn-main { width: 100%; padding: 18px; background: #E64A19; color: white; border: none; border-radius: 35px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 20px; }

        /* å¡ç‰‡è¨­è¨ˆ */
        .card { background: white; border-radius: 20px; padding: 25px; margin-top: 20px; border: 1px solid #FFCC80; text-align: left; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .card-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #FFF3E0; padding-bottom: 10px; margin-bottom: 15px; }
        .card-name { font-size: 22px; font-weight: bold; color: #E64A19; margin: 0; }
        .card-mbti { background: #FFECB3; color: #E64A19; padding: 4px 10px; border-radius: 10px; font-size: 14px; font-weight: bold; }

        /* çœŸå¯¦ç…§ç‰‡å±•ç¤ºå€ */
        .photo-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px; }
        .photo-item { aspect-ratio: 1/1; border-radius: 10px; border: 2px solid #FFCC80; object-fit: cover; width: 100%; background: #F5F5F5; }

        .card-bio { font-size: 15px; color: #5D4037; line-height: 1.6; background: #FFF9F0; padding: 15px; border-radius: 15px; margin-bottom: 15px; white-space: pre-wrap; }
        .card-detail { font-size: 14px; color: #666; margin-bottom: 5px; border-bottom: 1px dashed #EEE; padding-bottom: 5px; }
        .card-detail strong { color: #E64A19; }

        .action-area { margin-top: 15px; display: flex; align-items: center; justify-content: space-between; }
        .star-box { font-size: 28px; }
        .star-btn { cursor: pointer; color: #E0E0E0; padding: 0 4px; transition: 0.2s; }
        .star-btn.active { color: #FFC107; }
        .skip-btn { background: #CFD8DC; color: #546E7A; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-size: 13px; font-weight: bold; }
        .rated-badge { display: none; background: #EEE; color: #9E9E9E; padding: 10px; text-align: center; border-radius: 10px; font-weight: bold; }

        #fallback-box { text-align: center; display: none; margin-top: 20px; padding: 20px; background: #FFF3E0; border-radius: 20px; }
        #fallback-box img { width: 180px; border-radius: 50%; border: 4px solid #E64A19; margin-bottom: 15px; }

        #loading-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); color: white; text-align: center; padding-top: 200px; z-index: 1000; font-weight: bold; }
    </style>
</head>
<body>

<div id="loading-overlay">æ­£åœ¨ä¸Šå‚³ç…§ç‰‡ä¸¦å»ºç«‹é€£çµ...</div>

<div class="container">
    <button class="logout-btn" onclick="logout()">åˆ‡æ›èº«ä»½/è¨»å†Š</button>
    <h1>æœˆä¸‹è€äºº</h1>
    <p style="text-align: center; color: #8D6E63; font-size: 14px; margin-bottom: 20px;">æœˆéœé…’å§å°ˆå±¬é…å°ç³»çµ±</p>

    <div id="setup-page">
        <h2>1. éˆé­‚è‡ªæˆ‘ä»‹ç´¹ (ç½®é ‚)</h2>
        <div class="input-group">
            <label>è‡ªæˆ‘ä»‹ç´¹</label>
            <textarea id="uBio" placeholder="å¯«ä¸‹é—œæ–¼å¦³çš„æ•…äº‹... (é€™æ®µæ–‡å­—æœƒé¡¯ç¤ºåœ¨å¡ç‰‡æœ€é¡¯çœ¼çš„åœ°æ–¹)"></textarea>
        </div>
        <div class="input-group">
            <label>ç”Ÿæ´»ç…§ (è«‹é¸æ“‡ 3 å¼µçœŸå¯¦ç…§ç‰‡)</label>
            <input type="file" id="file1" accept="image/*" style="margin-bottom:5px;">
            <input type="file" id="file2" accept="image/*" style="margin-bottom:5px;">
            <input type="file" id="file3" accept="image/*">
            <p style="font-size: 12px; color: #8D6E63; margin-top:5px;">ğŸ’¡ ç…§ç‰‡å°‡æœƒä¸Šå‚³è‡³é›²ç«¯ä¸¦é¡¯ç¤ºåœ¨å¦³çš„å¡ç‰‡ä¸Šã€‚</p>
        </div>

        <div class="input-group"><label>å¦³çš„åå­— / æš±ç¨±</label><input type="text" id="uName"></div>
        
        <div class="input-group">
            <label>åŸºæœ¬è³‡æ–™</label>
            <div style="display:flex; gap:10px; flex-wrap:wrap;">
                <input type="date" id="uBirth" style="flex:1;">
                <input type="number" id="uHeight" placeholder="èº«é«˜(cm)" style="flex:1;">
            </div>
            <div style="display:flex; gap:10px; margin-top:10px;">
                <select id="uHoro"><option>ç‰¡ç¾Šåº§</option><option>é‡‘ç‰›åº§</option><option>é›™å­åº§</option><option>å·¨èŸ¹åº§</option><option>ç…å­åº§</option><option>è™•å¥³åº§</option><option>å¤©ç§¤åº§</option><option>å¤©è åº§</option><option>å°„æ‰‹åº§</option><option>æ‘©ç¾¯åº§</option><option>æ°´ç“¶åº§</option><option>é›™é­šåº§</option></select>
                <select id="uMbti">
                    <option value="">MBTI</option>
                    <optgroup label="åˆ†æå®¶"><option>INTJ å»ºç¯‰å¸«</option><option>INTP é‚è¼¯å­¸å®¶</option><option>ENTJ æŒ‡æ®å®˜</option><option>ENTP è¾¯è«–å®¶</option></optgroup>
                    <optgroup label="å¤–äº¤å®˜"><option>INFJ æå€¡è€…</option><option>INFP èª¿è§£è€…</option><option>ENFJ ä¸»äººå…¬</option><option>ENFP ç«¶é¸è€…</option></optgroup>
                    <optgroup label="å®ˆè­·è€…"><option>ISTJ ç‰©æµå¸«</option><option>ISFJ å®ˆè¡›è€…</option><option>ESTJ ç¸½ç®¡</option><option>ESFJ åŸ·æ”¿å®˜</option></optgroup>
                    <optgroup label="æ¢éšªå®¶"><option>ISTP é‘’è³å®¶</option><option>ISFP æ¢éšªå®¶</option><option>ESTP ä¼æ¥­å®¶</option><option>ESFP è¡¨æ¼”è€…</option></optgroup>
                </select>
            </div>
        </div>
        <div class="input-group"><label>æ€§åˆ¥èªåŒ</label><select id="uGender"><option>å¥³æ€§</option><option>è·¨å¥³</option><option>éäºŒå…ƒ</option><option>æ¢ç´¢ä¸­</option></select></div>
        <div class="input-group"><label>æ€§å–å‘</label><select id="uSex"><option>å¥³åŒå¿—</option><option>é›™æ€§æˆ€</option><option>ç•°æ€§æˆ€</option><option>æ³›æ€§æˆ€</option><option>ç„¡æ€§æˆ€</option></select></div>
        <div class="input-group"><label>æ„Ÿæƒ…ç‹€æ…‹</label><select id="uStatus"><option>å–®èº«</option><option>é–‹æ”¾å¼é—œä¿‚</option><option>æ›–æ˜§ä¸­</option><option>å°‹æ‰¾ç©©å®šé—œä¿‚</option></select></div>

        <h2>2. å€‹æ€§èˆ‡æœŸå¾…</h2>
        <div class="input-group"><label>ç ´å†°å›ç­”</label><input type="text" id="uIceA" placeholder="å¦‚æœä¸è€ƒæ…®éŒ¢ï¼Œæœ€æƒ³å»å“ªï¼Ÿ"></div>
        <div class="input-group"><label>é—œæ–¼å¯µç‰©</label><input type="text" id="uPet" placeholder="è²“æ´¾/ç‹—æ´¾/å…¶ä»–..."></div>
        <div class="input-group"><label>ç´„æœƒæœŸå¾…</label><select id="uDate"><option>å®‰éœå–å’–å•¡</option><option>å»çœ‹å±•è¦½</option><option>é…’ç²¾è·¯è·‘</option><option>çœ‹å¤œæ™¯</option><option>æ¼«æ­¥å…¬åœ’</option><option>éŠæ¨‚åœ’å†’éšª</option><option>æ‰‹ä½œå·¥ä½œåŠ</option><option>é›»å½±é¦¬æ‹‰æ¾</option><option>ç²¾ç·»æ³•é¤</option><option>å¯†å®¤é€ƒè„«</option></select></div>

        <h2>3. èˆˆè¶£ (å·²ç¨ç«‹åˆ†é–‹)</h2>
        <div class="input-group"><label>å–œæ­¡çš„é›»å½±</label><input type="text" id="uMovie" placeholder="ä¾‹å¦‚ï¼šç‹å®¶è¡›ã€ææ€–ç‰‡..."></div>
        <div class="input-group"><label>å–œæ­¡çš„éŸ³æ¨‚</label><input type="text" id="uMusic" placeholder="ä¾‹å¦‚ï¼šç¨ç«‹æ¨‚åœ˜ã€K-POP..."></div>
        <div class="input-group"><label>å–œæ­¡çš„é‹å‹•</label><input type="text" id="uSport" placeholder="ä¾‹å¦‚ï¼šçˆ¬å±±ã€æ½›æ°´ã€ç‘œä¼½..."></div>
        <div class="input-group"><label>å…¶ä»–èˆˆè¶£ç´°ç¯€</label><textarea id="uHobby" placeholder="é‚„æœ‰ä»€éº¼å…¶ä»–ç†±æ„›çš„ï¼Ÿ"></textarea></div>

        <h2>4. å¦³çš„å°ˆå±¬æ¨™ç±¤ (å„å€é™é¸3å€‹)</h2>
        <div id="tag-box"></div>

        <button class="btn-main" onclick="register()">å„²å­˜ä¸¦é€²å…¥æœƒå ´</button>
    </div>

    <div id="venue-page" style="display:none;">
        <div id="fallback-box">
            <img src="staff_old_man.jpg" alt="æœˆè€è½‰ä»‹">
            <p style="color:#E64A19; font-weight:bold; font-size:18px;">ã€Œç·£åˆ†æ­£åœ¨é…’å§å¾®é†ºä¸­...ã€</p>
            <p style="font-size:14px; color:#8D6E63;">ç›®å‰å°šç„¡é«˜åº¦å¥‘åˆå°è±¡ã€‚<br>åˆ¥æ“”å¿ƒï¼Œå…ˆå–ä¸€æ¯ï¼Œè®“ç¾å ´æœˆè€è¦ªè‡ªç‚ºå¦³ç‰½ç·šå§ï¼</p>
        </div>
        <div id="user-cards"></div>
    </div>
</div>

<script>
    // --- âš ï¸ å¦³çš„ Firebase Config (å·²å¡«å…¥) ---
    const firebaseConfig = {
        apiKey: "AIzaSyDv4EOEmJ8dFwgZEv5mYtaiXuzbwgjMAUA",
        authDomain: "jariah-match.firebaseapp.com",
        projectId: "jariah-match",
        storageBucket: "jariah-match.firebasestorage.app",
        messagingSenderId: "863372390147",
        appId: "1:863372390147:web:7541b1b478c33f3d824336",
        measurementId: "G-GDNBERRJJ1"
    };
    
    // åˆå§‹åŒ– Firebase
    firebase.initializeApp(firebaseConfig);
    const storage = firebase.storage();

    const API_URL = 'https://script.google.com/macros/s/AKfycbzGGOXqSP0_De4InUp-xBGIux_CuCAS600ACuLE-UFLzlPkPrR_3U6QGCHJKIK1dbMV/exec';

    const tagData = {
        social: ["ç†±æƒ…ä¸»å‹•", "æ…¢ç†±å…§æ–‚", "å¹½é»˜é¢¨è¶£", "å„ªè³ªå‚¾è½", "ç›´è¨€ä¸è«±", "æº«æŸ”é«”è²¼", "ç¨ç«‹è‡ªä¸»", "æ·±åº¦å°è©±", "éš¨å’Œéš¨èˆˆ", "å¥½å¥‡å¿ƒå¼·", "è§€å¯Ÿæ•éŠ³", "çµ¦äºˆç©ºé–“", "æœ‰ä¸»è¦‹", "ä¸æ‹˜å°ç¯€", "å„ªé›…å¾—é«”"],
        emotion: ["æ„Ÿæ€§ç´°è†©", "å†·éœç†æ™º", "æƒ…ç·’ç©©å®š", "åŒç†å¿ƒå¼·", "ç›´è¦ºæ•éŠ³", "æ¨‚è§€ç©æ¥µ", "å…§æ–‚å¹³éœ", "æƒ…æ„Ÿå……æ²›", "éš¨é‡è€Œå®‰", "è¬¹æ…é˜²å‚™", "æ¸´æœ›å…±é³´", "è‡ªæˆ‘è¦ºå¯Ÿ", "å¦ç‡å¤§æ–¹", "å®‰ç©©è¸å¯¦", "è¿½æ±‚æˆé•·"],
        value: ["äº‹æ¥­å„ªå…ˆ", "é‡è¦–å®¶åº­", "æˆ¶å¤–å†’éšª", "å®…åœ¨å®¶ä¸­", "æ¥µç°¡ä¸»ç¾©", "äº«æ¨‚ç”Ÿæ´»", "è—è¡“å“å‘³", "æ€§åˆ¥å¹³æ¬Š", "ç©©å®šå®‰é€¸", "æ´»åœ¨ç•¶ä¸‹", "è²¡å‹™è‡ªç”±", "æ„›è­·å‹•ç‰©", "å„€å¼æ„Ÿ", "è‡ªç”±ä¸ç¾ˆ", "å¥åº·é¤Šç”Ÿ"],
        food: ["æ—¥å¼", "ç¾©å¼", "ç¾å¼", "éŸ“å¼", "å°å¼ç†±ç‚’", "æ³•å¼", "ç«é‹", "è”¬é£Ÿ", "ç”œé»", "å°åƒ", "ç²¾é‡€å•¤é…’", "æ·±å¤œé£Ÿå ‚", "ç•°åœ‹é¦™æ–™", "æµ·é®®", "å’–å•¡"],
        style: ["æ­ç¾", "æ—¥ç³»æ–‡é’", "éŸ“ç³»æº«æŸ”", "è¡—é ­", "å¾©å¤", "æ­£å¼", "ç”œç¾", "ä¸­æ€§å¸¥æ°£", "é‹å‹•", "æ³¢è¥¿ç±³äº", "é»‘è‰²ç³»", "æ…µæ‡¶", "ç¹½ç´›", "æ¥µç°¡", "å±±ç³»"]
    };

    const tBox = document.getElementById('tag-box');
    Object.keys(tagData).forEach(key => {
        let title = key==='social'?'ç¤¾äº¤é¢¨æ ¼':key==='emotion'?'æƒ…ç·’æ„Ÿå—':key==='value'?'åƒ¹å€¼è§€':key==='food'?'ç¾é£Ÿ':key==='style'?'ç©¿æ­':'';
        tBox.innerHTML += `<h3>${title}</h3><div class="tag-container" id="${key}-tags"></div>`;
        const container = document.getElementById(`${key}-tags`);
        const limitClass = (['social','emotion','value'].includes(key)) ? 'limit-3' : '';
        tagData[key].forEach((t, i) => {
            container.innerHTML += `<input type="checkbox" id="${key}-${i}" class="tag-checkbox ${limitClass}" value="${t}"><label for="${key}-${i}" class="tag-label">${t}</label>`;
        });
    });

    document.body.addEventListener('change', (e) => {
        if (e.target.classList.contains('limit-3')) {
            const group = e.target.parentElement;
            const checked = group.querySelectorAll('.limit-3:checked').length;
            group.querySelectorAll('.limit-3:not(:checked)').forEach(cb => cb.disabled = (checked >= 3));
        }
    });

    if(localStorage.getItem('yueLaoUser')) showVenue();
    
    function logout() { 
        if(confirm('ç¢ºå®šè¦åˆ‡æ›èº«ä»½å—ï¼Ÿ')) {
            localStorage.removeItem('yueLaoUser'); 
            location.reload(); 
        }
    }

    // ä¸Šå‚³åœ–ç‰‡åˆ° Firebase ä¸¦å›å‚³ URL
    async function uploadImage(file) {
        if (!file) return "";
        const ref = storage.ref('users/' + new Date().getTime() + '_' + file.name);
        await ref.put(file);
        return await ref.getDownloadURL();
    }

    async function register() {
        const name = document.getElementById('uName').value;
        if(!name) return alert('è«‹å¡«å¯«åå­—');
        
        document.getElementById('loading-overlay').style.display = 'block';

        // 1. å…ˆä¸Šå‚³ç…§ç‰‡åˆ° Firebase
        const p1Url = await uploadImage(document.getElementById('file1').files[0]);
        const p2Url = await uploadImage(document.getElementById('file2').files[0]);
        const p3Url = await uploadImage(document.getElementById('file3').files[0]);

        // 2. æº–å‚™æ‰“åŒ…è³‡æ–™ (å«ç¨ç«‹çš„èˆˆè¶£æ¬„ä½)
        const payload = {
            action: "register",
            uName: name, 
            p1: p1Url, // å‚³é€çœŸå¯¦ç¶²å€
            p2: p2Url,
            p3: p3Url,
            uBio: document.getElementById('uBio').value, 
            uBirth: document.getElementById('uBirth').value, 
            uHeight: document.getElementById('uHeight').value, 
            uHoro: document.getElementById('uHoro').value,
            uMbti: document.getElementById('uMbti').value, 
            uGender: document.getElementById('uGender').value,
            uSex: document.getElementById('uSex').value, 
            uStatus: document.getElementById('uStatus').value,
            uIceA: document.getElementById('uIceA').value,
            uPet: document.getElementById('uPet').value,
            uDate: document.getElementById('uDate').value,
            // ç¨ç«‹åˆ†é–‹çš„èˆˆè¶£
            uMovie: document.getElementById('uMovie').value,
            uMusic: document.getElementById('uMusic').value,
            uSport: document.getElementById('uSport').value,
            uHobby: document.getElementById('uHobby').value,
            // æ¨™ç±¤
            tagSocial: Array.from(document.querySelectorAll('#social-tags input:checked')).map(el => el.value).join(','),
            tagEmotion: Array.from(document.querySelectorAll('#emotion-tags input:checked')).map(el => el.value).join(','),
            tagValue: Array.from(document.querySelectorAll('#value-tags input:checked')).map(el => el.value).join(','),
            tagFood: Array.from(document.querySelectorAll('#food-tags input:checked')).map(el => el.value).join(','),
            tagStyle: Array.from(document.querySelectorAll('#style-tags input:checked')).map(el => el.value).join(',')
        };
        
        // 3. å‚³é€åˆ° Google è©¦ç®—è¡¨
        await fetch(API_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) });
        localStorage.setItem('yueLaoUser', name);
        setTimeout(showVenue, 2000); // ç­‰å¾…æ™‚é–“ç¨é•·ä¸€é»ï¼Œç¢ºä¿ç…§ç‰‡ä¸Šå‚³å®Œæˆ
    }

    async function showVenue() {
        document.getElementById('loading-overlay').style.display = 'none';
        document.getElementById('setup-page').style.display = 'none';
        document.getElementById('venue-page').style.display = 'block';
        window.scrollTo(0,0);

        const res = await fetch(API_URL);
        const data = await res.json();
        const me = localStorage.getItem('yueLaoUser');
        const cardBox = document.getElementById('user-cards');
        const fallback = document.getElementById('fallback-box');

        const myMatches = data.adminStats.filter(s => (s.p1 === me || s.p2 === me) && s.isMatch);

        cardBox.innerHTML = '';
        if(myMatches.length > 0) {
            fallback.style.display = 'none';
            cardBox.innerHTML += `
                <div style="background:#FFF3E0;padding:20px;border-radius:20px;margin-bottom:20px;border:3px dashed #E64A19;text-align:center;">
                    <h3 style="margin:0;color:#E64A19;font-size:20px;">ğŸ’– é…å°æˆåŠŸï¼</h3>
                    ${myMatches.map(m => {
                        const p = (m.p1 === me) ? m.p2 : m.p1;
                        return `<div style="font-size:18px;font-weight:bold;margin-top:5px;">âœ¨ ${p} (é»˜å¥‘ ${m.total} åˆ†)</div>`;
                    }).join('')}
                </div>`;
        } else {
            fallback.style.display = 'block';
        }

        const ratedList = data.ratedHistory || {};
        const otherUsers = data.users.filter(u => u.name !== me);

        if (otherUsers.length > 0) fallback.style.display = 'none';

        otherUsers.forEach(u => {
            const hasRated = ratedList[me + "_" + u.name];
            
            // è™•ç†ç…§ç‰‡é¡¯ç¤º
            const img1 = u.p1 ? `<img src="${u.p1}" class="photo-item">` : '<div class="photo-item" style="display:flex;align-items:center;justify-content:center;color:#CCC;">ç„¡ç…§ç‰‡</div>';
            const img2 = u.p2 ? `<img src="${u.p2}" class="photo-item">` : '<div class="photo-item" style="display:flex;align-items:center;justify-content:center;color:#CCC;">ç„¡ç…§ç‰‡</div>';
            const img3 = u.p3 ? `<img src="${u.p3}" class="photo-item">` : '<div class="photo-item" style="display:flex;align-items:center;justify-content:center;color:#CCC;">ç„¡ç…§ç‰‡</div>';

            // é¡¯ç¤ºæ‰€æœ‰èˆˆè¶£æ¬„ä½
            cardBox.innerHTML += `
                <div class="card">
                    <div class="card-header">
                        <span class="card-name">${u.name} - ${u.horo}</span>
                        <span class="card-mbti">${u.mbti}</span>
                    </div>

                    <div class="photo-grid">
                        ${img1}${img2}${img3}
                    </div>

                    <div class="card-bio">${u.bio || "ï¼ˆé€™ä½æœ‹å‹é‚„æ²’å¯«è‡ªæˆ‘ä»‹ç´¹...ï¼‰"}</div>

                    <div class="card-detail"><strong>åŸºæœ¬ï¼š</strong>${u.birth || ''} / ${u.height || ''}cm / ${u.status || ''}</div>
                    <div class="card-detail"><strong>ç ´å†°ï¼š</strong>${u.ice || ''}</div>
                    <div class="card-detail"><strong>å¯µç‰©ï¼š</strong>${u.pet || ''}</div>
                    <div class="card-detail"><strong>æœŸå¾…ï¼š</strong>${u.date || ''}</div>
                    <div class="card-detail"><strong>é›»å½±ï¼š</strong>${u.movie || 'ç„¡'}</div>
                    <div class="card-detail"><strong>éŸ³æ¨‚ï¼š</strong>${u.music || 'ç„¡'}</div>
                    <div class="card-detail"><strong>é‹å‹•ï¼š</strong>${u.sport || 'ç„¡'}</div>
                    <div class="card-detail"><strong>å…¶ä»–ï¼š</strong>${u.hobby || 'ç„¡'}</div>

                    <div class="action-area" id="action-${u.name}" style="display:${hasRated ? 'none' : 'flex'}">
                        <div class="star-box">
                            ${[1,2,3,4,5].map(i => `<span class="star-btn" onclick="rate('${u.name}', ${i})">â˜…</span>`).join('')}
                        </div>
                        <button class="skip-btn" onclick="rate('${u.name}', 0)">ç•¥é</button>
                    </div>

                    <div class="rated-badge" style="display:${hasRated ? 'block' : 'none'}">
                        âœ… å·²é€å‡ºå¿ƒæ„
                    </div>
                </div>`;
        });
    }

    async function rate(toUser, score) {
        const fromUser = localStorage.getItem('yueLaoUser');
        document.getElementById(`action-${toUser}`).style.display = 'none';
        const card = document.getElementById(`action-${toUser}`).parentElement;
        card.querySelector('.rated-badge').style.display = 'block';
        await fetch(API_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ action: "rate", fromUser, toUser, stars: score }) });
    }
</script>
</body>
</html>
