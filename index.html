<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœˆä¸‹è€äºº - è¯èª¼é…å°ç³»çµ±</title>
    <style>
        /* --- æ ¸å¿ƒè¦–è¦ºï¼šå¦³è¦æ±‚çš„æ©˜é»ƒè‰²ä¸»é¡Œ --- */
        body { font-family: 'PingFang TC', sans-serif; background-color: #FFB74D; margin: 0; padding: 10px; color: #4E342E; }
        .container { max-width: 650px; margin: 10px auto; background-color: #FFF9F0; padding: 25px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        h1 { color: #E64A19; text-align: center; font-size: 32px; margin-bottom: 5px; }
        .subtitle { text-align: center; color: #8D6E63; margin-bottom: 25px; font-size: 14px; }
        h2 { border-left: 5px solid #E64A19; padding-left: 10px; color: #5D4037; font-size: 20px; margin-top: 35px; background: #FFECB3; padding: 5px 10px; border-radius: 5px; }
        h3 { font-size: 17px; margin-top: 25px; color: #D84315; border-bottom: 1px solid #FFCC80; padding-bottom: 5px; }
        .section { margin-bottom: 35px; }
        .input-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; font-size: 15px; color: #5D4037; }
        input, select, textarea { width: 100%; padding: 12px; border: 1.5px solid #FFCC80; border-radius: 12px; font-size: 16px; box-sizing: border-box; background: white; }
        textarea { resize: vertical; min-height: 100px; }
        .btn-test { display: inline-block; margin-top: 8px; padding: 8px 16px; background-color: #FB8C00; color: white; text-decoration: none; border-radius: 20px; font-size: 13px; font-weight: bold; }
        /* æ¨™ç±¤è¨­è¨ˆ */
        .tag-container { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 12px; }
        .tag-checkbox { display: none; }
        .tag-label { display: inline-block; padding: 7px 14px; border: 1.5px solid #FFCC80; border-radius: 20px; background-color: #FFF; color: #5D4037; cursor: pointer; font-size: 13px; transition: 0.2s; }
        .tag-checkbox:checked + .tag-label { background-color: #FF8A80; color: white; border-color: #FF8A80; }
        .tag-checkbox:disabled + .tag-label { opacity: 0.3; cursor: not-allowed; }
        .btn-main { width: 100%; padding: 18px; background-color: #E64A19; color: white; border: none; border-radius: 35px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 30px; }
        .card { background: white; border-radius: 20px; padding: 20px; margin-top: 20px; border: 1px solid #FFCC80; text-align: left; }
        #loading-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); color: white; text-align: center; padding-top: 200px; z-index: 1000; font-weight: bold; }
    </style>
</head>
<body>

<div id="loading-overlay">æ­£åœ¨é€£çµç·£åˆ†è³‡æ–™åº«...</div>

<div class="container">
    <h1>æœˆä¸‹è€äºº</h1>
    <div class="subtitle">è®“å‘½ä¸­æ³¨å®šçš„å¦³å€‘åœ¨é€™è£¡ç›¸é‡</div>

    <div id="setup-page">
        <div class="section">
            <h2>1. åŸºæœ¬ç¡¬æ€§è³‡æ–™</h2>
            
            <div class="input-group">
                <label>ç”Ÿæ´»ç…§ (æœ€å¤šä¸‰å¼µ)</label>
                <input type="file" id="p1" accept="image/*" style="margin-bottom:8px;"><br>
                <input type="file" id="p2" accept="image/*" style="margin-bottom:8px;"><br>
                <input type="file" id="p3" accept="image/*">
                <p style="font-size: 12px; color: #8D6E63; margin-top: 5px;">ğŸ’¡ å±•ç¾æœ€çœŸå¯¦çš„å¦³ï¼Œè®“å‘½ä¸­æ³¨å®šçš„å°è±¡èƒ½ä¸€çœ¼èªå‡ºå¦³å–”ã€‚</p>
            </div>

            <div class="input-group"><label>å¦³çš„åå­— / æš±ç¨±</label><input type="text" id="userName" placeholder="å¦‚ä½•ç¨±å‘¼å¦³ï¼Ÿ"></div>

            <div class="input-group"><label>è‡ªæˆ‘ä»‹ç´¹ (é–‹æ”¾å¼å¡«å¯«)</label><textarea id="userBio" placeholder="é—œæ–¼å¦³çš„æ•…äº‹ã€èˆˆè¶£ï¼Œæˆ–æ˜¯æœŸå¾…..."></textarea></div>

            <div class="input-group"><label>å‡ºç”Ÿå¹´æœˆæ—¥</label><input type="date" id="birthDate"></div>
            <div class="input-group"><label>èº«é«˜ (cm)</label><input type="number" id="heightInput" min="100" max="220" placeholder="100-220"></div>
            <div class="input-group"><label>æ˜Ÿåº§</label><select id="horoSelect"><option>ç‰¡ç¾Šåº§</option><option>é‡‘ç‰›åº§</option><option>é›™å­åº§</option><option>å·¨èŸ¹åº§</option><option>ç…å­åº§</option><option>è™•å¥³åº§</option><option>å¤©ç§¤åº§</option><option>å¤©è åº§</option><option>å°„æ‰‹åº§</option><option>æ‘©ç¾¯åº§</option><option>æ°´ç“¶åº§</option><option>é›™é­šåº§</option></select></div>
            <div class="input-group"><label>æ€§åˆ¥èªåŒ</label><select id="genderId"><option>å¥³æ€§</option><option>è·¨å¥³</option><option>éäºŒå…ƒ</option><option>æ¢ç´¢ä¸­</option></select></div>
            <div class="input-group"><label>æ€§å–å‘</label><select id="sexOrient"><option>å¥³åŒå¿—</option><option>é›™æ€§æˆ€</option><option>ç•°æ€§æˆ€</option><option>æ³›æ€§æˆ€</option><option>ç„¡æ€§æˆ€</option></select></div>
            <div class="input-group"><label>æ„Ÿæƒ…ç‹€æ…‹</label><select id="relState"><option>å–®èº«</option><option>é–‹æ”¾å¼é—œä¿‚</option><option>æ›–æ˜§ä¸­</option><option>å°‹æ‰¾ç©©å®šé—œä¿‚</option></select></div>
            <div class="input-group"><label>MBTI</label><a href="https://www.16personalities.com/tw" target="_blank" class="btn-test">é»æˆ‘æ¸¬è©¦</a><select id="mbtiSelect" style="margin-top:10px;"><option>æˆ‘ä¸çŸ¥é“</option><option>INTJ</option><option>ENFP</option><option>INFP</option><option>INFJ</option><option>ENTP</option></select></div>
        </div>

        <div class="section">
            <h2>2. ç´„æœƒæœŸå¾…</h2>
            <div class="input-group"><label>ç ´å†°å•å¥å›ç­”</label><select id="iceQ"><option>å¦‚æœä¸è€ƒæ…®éŒ¢ï¼Œæˆ‘æœ€æƒ³å»çš„åœ°æ–¹æ˜¯...</option><option>ç†æƒ³é€±æœ«é€šå¸¸æ˜¯é€™æ¨£é...</option></select><textarea id="iceA" style="margin-top:10px;" placeholder="åœ¨æ­¤å¡«å¯«å›ç­”..."></textarea></div>
            <div class="input-group"><label>å¯µç‰©åå¥½</label><select id="petPref"><option>è²“æ´¾</option><option>ç‹—æ´¾</option><option>éƒ½æœ‰</option><option>éƒ½æ²’æœ‰ä½†å–œæ­¡</option></select></div>
            <div class="input-group">
                <label>ç†æƒ³ç¬¬ä¸€æ¬¡ç´„æœƒ (10å€‹é¸é …)</label>
                <select id="datePref">
                    <option>å®‰éœå–å’–å•¡</option><option>å»çœ‹å±•è¦½</option><option>é…’ç²¾è·¯è·‘</option><option>çœ‹å¤œæ™¯</option><option>æ¼«æ­¥å…¬åœ’</option>
                    <option>éŠæ¨‚åœ’</option><option>æ‰‹ä½œå·¥ä½œåŠ</option><option>é›»å½±é¦¬æ‹‰æ¾</option><option>ç²¾ç·»æ³•é¤</option><option>å¯†å®¤é€ƒè„«</option>
                </select>
            </div>
        </div>

        <div class="section">
            <h2>3. é¢¨æ ¼æ¨™ç±¤ (å„å€é™é¸3é …)</h2>
            <div id="tag-box"></div>
        </div>

        <div class="section">
            <h2>4. ç”Ÿæ´»èˆˆè¶£ (æ‰‹å¡«)</h2>
            <div class="input-group"><label>é›»å½± / éŸ³æ¨‚ / é‹å‹• / èˆˆè¶£</label><textarea id="hobbiesManual" placeholder="æ‰‹å¯«å¡«å¯«å¦³çš„ç†±æ„›..."></textarea></div>
        </div>

        <div class="section">
            <h2>5. ç¾æ„Ÿå–œå¥½ (å¤šé¸)</h2>
            <div id="pref-box"></div>
        </div>

        <button class="btn-main" onclick="sendToCloud()">å„²å­˜è³‡æ–™ä¸¦é€²å…¥æœƒå ´</button>
    </div>

    <div id="venue-page" style="display:none;">
        <h2>æ¢ç´¢å°è±¡</h2>
        <div id="userList">è¼‰å…¥ä¸­...</div>
        <button class="btn-main" onclick="location.reload()" style="background:#8D6E63;">å›ä¿®æ”¹é é¢</button>
    </div>
</div>

<script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbzGGOXqSP0_De4InUp-xBGIux_CuCAS600ACuLE-UFLzlPkPrR_3U6QGCHJKIK1dbMV/exec';

    const tags = {
        social: ["ç†±æƒ…ä¸»å‹•", "æ…¢ç†±å…§æ–‚", "å¹½é»˜é¢¨è¶£", "å„ªè³ªå‚¾è½", "ç›´è¨€ä¸è«±", "æº«æŸ”é«”è²¼", "ç¨ç«‹è‡ªä¸»", "æ·±åº¦å°è©±", "éš¨å’Œ", "å¥½å¥‡å¿ƒ", "æ•éŠ³", "ç©ºé–“æ„Ÿ", "ä¸»è¦‹", "ä¸æ‹˜å°ç¯€", "å„ªé›…å¾—é«”"],
        emotion: ["æ„Ÿæ€§ç´°è†©", "å†·éœç†æ™º", "æƒ…ç·’ç©©å®š", "åŒç†å¿ƒå¼·", "ç›´è¦ºæ•éŠ³", "æ¨‚è§€ç©æ¥µ", "å…§æ–‚å¹³éœ", "æƒ…æ„Ÿå……æ²›", "éš¨é‡è€Œå®‰", "è¬¹æ…é˜²å‚™", "æ¸´æœ›å…±é³´", "è‡ªæˆ‘è¦ºå¯Ÿ", "å¦ç‡å¤§æ–¹", "å®‰ç©©è¸å¯¦", "è¿½æ±‚æˆé•·"],
        value: ["äº‹æ¥­å„ªå…ˆ", "é‡è¦–å®¶åº­", "æˆ¶å¤–å†’éšª", "å®…åœ¨å®¶ä¸­", "æ¥µç°¡ä¸»ç¾©", "äº«æ¨‚ç”Ÿæ´»", "è—è¡“å“å‘³", "æ€§åˆ¥å¹³æ¬Š", "ç©©å®šå®‰é€¸", "æ´»åœ¨ç•¶ä¸‹", "è²¡å‹™è‡ªç”±", "æ„›è­·å‹•ç‰©", "å„€å¼æ„Ÿ", "è‡ªç”±ä¸ç¾ˆ", "å¥åº·é¤Šç”Ÿ"],
        food: ["æ—¥å¼", "ç¾©å¼", "ç¾å¼", "éŸ“å¼", "å°å¼ç†±ç‚’", "æ³•å¼", "ç«é‹", "è”¬é£Ÿ", "ç”œé»", "å°åƒ", "ç²¾é‡€å•¤é…’", "æ·±å¤œé£Ÿå ‚", "é¦™æ–™", "æµ·é®®", "å’–å•¡"],
        style: ["æ­ç¾", "æ–‡é’", "æº«æŸ”", "è¡—é ­", "å¾©å¤", "æ­£å¼", "ç”œç¾", "ä¸­æ€§å¸¥æ°£", "é‹å‹•", "æ³¢è¥¿ç±³äº", "é»‘è‰²ç³»", "æ…µæ‡¶", "ç¹½ç´›", "æ¥µç°¡", "å±±ç³»"]
    };

    function render(id, list, container, limit) {
        list.forEach((item, i) => {
            container.innerHTML += `<input type="checkbox" id="${id}-${i}" class="tag-checkbox ${limit}" value="${item}"><label for="${id}-${i}" class="tag-label">${item}</label>`;
        });
    }

    const tagBox = document.getElementById('tag-box');
    ['social', 'emotion', 'value'].forEach(t => {
        tagBox.innerHTML += `<h3>${t === 'social' ? 'ç¤¾äº¤é¢¨æ ¼' : t === 'emotion' ? 'æƒ…ç·’æ„Ÿå—' : 'ç”Ÿæ´»åƒ¹å€¼è§€'}</h3><div class="tag-container" id="${t}-tags"></div>`;
        render(t, tags[t], document.getElementById(`${t}-tags`), 'limit-3');
    });

    const prefBox = document.getElementById('pref-box');
    ['food', 'style'].forEach(t => {
        prefBox.innerHTML += `<h3>${t === 'food' ? 'ç¾é£Ÿå–œå¥½' : 'ç©¿è¡£é¢¨æ ¼'}</h3><div class="tag-container" id="${t}-tags"></div>`;
        render(t, tags[t], document.getElementById(`${t}-tags`), '');
    });

    document.body.addEventListener('change', (e) => {
        if (e.target.classList.contains('limit-3')) {
            const group = e.target.parentElement;
            const checked = group.querySelectorAll('.limit-3:checked').length;
            group.querySelectorAll('.limit-3:not(:checked)').forEach(cb => cb.disabled = (checked >= 3));
        }
    });

    async function sendToCloud() {
        const name = document.getElementById('userName').value;
        if(!name) return alert('è«‹å¡«å¯«åå­—');
        document.getElementById('loading-overlay').style.display = 'block';

        const payload = {
            userName: name, bio: document.getElementById('userBio').value, birth: document.getElementById('birthDate').value,
            height: document.getElementById('heightInput').value, horo: document.getElementById('horoSelect').value,
            gender: document.getElementById('genderId').value, sex: document.getElementById('sexOrient').value,
            status: document.getElementById('relState').value, mbti: document.getElementById('mbtiSelect').value,
            iceA: document.getElementById('iceA').value, pet: document.getElementById('petPref').value,
            date: document.getElementById('datePref').value, hobby: document.getElementById('hobbiesManual').value,
            social: Array.from(document.querySelectorAll('#social-tags input:checked')).map(el => el.value).join(','),
            emotion: Array.from(document.querySelectorAll('#emotion-tags input:checked')).map(el => el.value).join(','),
            value: Array.from(document.querySelectorAll('#value-tags input:checked')).map(el => el.value).join(','),
            food: Array.from(document.querySelectorAll('#food-tags input:checked')).map(el => el.value).join(','),
            style: Array.from(document.querySelectorAll('#style-tags input:checked')).map(el => el.value).join(',')
        };

        try { await fetch(API_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) }); } catch (e) {}
        setTimeout(loadVenue, 1500);
    }

    async function loadVenue() {
        document.getElementById('loading-overlay').style.display = 'none';
        document.getElementById('setup-page').style.display = 'none';
        document.getElementById('venue-page').style.display = 'block';
        window.scrollTo(0, 0);

        const res = await fetch(API_URL);
        const users = await res.json();
        const listDiv = document.getElementById('userList');
        listDiv.innerHTML = '';
        users.forEach(u => {
            if(u.name !== document.getElementById('userName').value) {
                listDiv.innerHTML += `<div class="card"><h3>${u.name} - ${u.horoscope || u.horo}</h3><p>MBTI: ${u.mbti}</p><p>${u.bio}</p><div style="color: gold; font-size: 20px;">â˜… â˜… â˜… â˜… â˜…</div></div>`;
            }
        });
    }
</script>
</body>
</html>
