<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Jariah ç®¡ç†å¾Œå° - ç…§ç‰‡é è¦½ç‰ˆ</title>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f8f9fa; }
        .card { background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #eee; padding: 12px; text-align: left; }
        th { background: #764ba2; color: white; }
        .img-thumb { width: 60px; height: 60px; object-fit: cover; border-radius: 5px; margin-right: 5px; border: 1px solid #ddd; }
        .match-box { background: #fff5f6; border-left: 5px solid #ff4757; padding: 15px; margin-bottom: 10px; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Jariah æ´»å‹•ç®¡ç†å¾Œå°</h1>
    <button onclick="exportToExcel()" style="background:#27ae60; color:white; padding:10px 20px; border:none; border-radius:5px; cursor:pointer;">ğŸ“Š åŒ¯å‡º Excel åå–®</button>

    <div class="card">
        <h2>ğŸ”¥ æœ€ä½³é…å°çµ„åˆ (åˆè¨ˆåˆ†æ•¸æœ€é«˜å„ªå…ˆ)</h2>
        <div id="match-list">è¨ˆç®—ä¸­...</div>
    </div>

    <div class="card">
        <h2>ğŸ‘¥ åƒåŠ è€…åå†Š (å«ç…§ç‰‡é è¦½)</h2>
        <table>
            <thead><tr><th>ç…§ç‰‡</th><th>æš±ç¨±</th><th>æ‰‹æ©Ÿ</th><th>è·æ¥­</th></tr></thead>
            <tbody id="user-body"></tbody>
        </table>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, getDocs, orderBy, query } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    const cfg = { apiKey: "AIzaSyDv4EOEmJ8dfWgZEv5mYtaiXuzbwgjMAUA", authDomain: "jariah-match.firebaseapp.com", projectId: "jariah-match", storageBucket: "jariah-match.firebasestorage.app", messagingSenderId: "863372390147", appId: "1:863372390147:web:7541b1b478c33f3d824336" };
    const app = initializeApp(cfg); const db = getFirestore(app);
    let excelData = [];

    async function load(){
        // 1. è¼‰å…¥åƒåŠ è€…ç…§ç‰‡èˆ‡è³‡æ–™
        const usnap = await getDocs(query(collection(db, "users"), orderBy("createdAt", "desc")));
        const ub = document.getElementById('user-body');
        usnap.forEach(d => {
            const u = d.data();
            excelData.push({ "æš±ç¨±": u.name, "é›»è©±": u.phone, "MBTI": u.mbti, "è·æ¥­": u.job });
            // è™•ç†ä¸‰å¼µç…§ç‰‡çš„é¡¯ç¤º
            const p = u.photos.filter(x=>x).map(x=>`<img src="${x}" class="img-thumb">`).join('');
            ub.innerHTML += `<tr><td>${p}</td><td><b>${u.name}</b></td><td>${u.phone}</td><td>${u.job}</td></tr>`;
        });

        // 2. é…å°é‚è¼¯ (èˆ‡å‰ç‰ˆç›¸åŒ) ...
    }
    window.exportToExcel = () => {
        const ws = XLSX.utils.json_to_sheet(excelData);
        const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, "åå–®");
        XLSX.writeFile(wb, "æ´»å‹•åå†Š.xlsx");
    };
    load();
</script>
</body>
</html>
