<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Jariah å¾Œå° - Excel åŒ¯å‡ºç‰ˆ</title>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f4f7f6; }
        .btn { padding: 10px 20px; border-radius: 5px; border: none; cursor: pointer; font-weight: bold; }
        .btn-excel { background: #27ae60; color: white; margin-right: 10px; }
        table { width: 100%; background: white; border-collapse: collapse; margin-top: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background: #764ba2; color: white; }
    </style>
</head>
<body>
    <h1>æ´»å‹•ç®¡ç†å¾Œå°</h1>
    <button class="btn btn-excel" onclick="exportData()">ğŸ“Š åŒ¯å‡º Excel åå–®</button>
    <button class="btn" onclick="location.reload()">é‡æ–°æ•´ç†</button>

    <h2>åƒåŠ è€…è³‡æ–™</h2>
    <table id="tbl">
        <thead><tr><th>ç…§ç‰‡</th><th>æš±ç¨±</th><th>æ‰‹æ©Ÿ</th><th>MBTI</th><th>è·æ¥­</th></tr></thead>
        <tbody id="ub"></tbody>
    </table>

    <h2>æˆåŠŸé…å°ç´€éŒ„</h2>
    <div id="ml" style="margin-top:20px; background:white; padding:15px; border-radius:10px;">æ­£åœ¨è®€å–ç´€éŒ„...</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, getDocs, orderBy, query } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    const cfg = { apiKey: "AIzaSyDv4EOEmJ8dfWgZEv5mYtaiXuzbwgjMAUA", authDomain: "jariah-match.firebaseapp.com", projectId: "jariah-match", storageBucket: "jariah-match.firebasestorage.app", messagingSenderId: "863372390147", appId: "1:863372390147:web:7541b1b478c33f3d824336" };
    const app = initializeApp(cfg); const db = getFirestore(app);
    let ex = [];

    async function load(){
        const usnap = await getDocs(query(collection(db, "users"), orderBy("createdAt", "desc")));
        const ub = document.getElementById('ub');
        usnap.forEach(d => {
            const u = d.data();
            ex.push({ "æš±ç¨±": u.name, "é›»è©±": u.phone, "MBTI": u.mbti, "è·æ¥­": u.job });
            const p = u.photos && u.photos[0] ? `<img src="${u.photos[0]}" style="width:50px; height:50px; object-fit:cover;">` : 'ç„¡';
            ub.innerHTML += `<tr><td>${p}</td><td>${u.name}</td><td>${u.phone}</td><td>${u.mbti}</td><td>${u.job}</td></tr>`;
        });

        const msnap = await getDocs(collection(db, "matches"));
        const ml = document.getElementById('ml'); ml.innerHTML = "";
        msnap.forEach(d => {
            const m = d.data();
            ml.innerHTML += `<div>ğŸ”¥ <b>${m.pair[0]}</b> â¤ï¸ <b>${m.pair[1]}</b> (è©•åˆ†: ${m.score})</div>`;
        });
    }

    window.exportData = () => {
        const ws = XLSX.utils.json_to_sheet(ex);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "åƒåŠ è€…æ¸…å–®");
        XLSX.writeFile(workbook, "è¯èª¼æ´»å‹•åå†Š.xlsx");
    };
    load();
</script>
</body>
</html>
