<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Jariah å¾Œå°ç®¡ç†</title>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f0f2f5; }
        .card { background: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; border: 1px solid #eee; text-align: left; }
        th { background: #764ba2; color: white; }
        .thumb { width: 45px; height: 45px; object-fit: cover; border-radius: 5px; margin-right: 5px; }
    </style>
</head>
<body>
    <h1>æœˆéœæ´»å‹•å¾Œå°</h1>
    <div class="card">
        <button onclick="exportExcel()" style="padding:10px; background:#27ae60; color:white; border:none; border-radius:5px; cursor:pointer;">ğŸ“Š åŒ¯å‡ºå®Œæ•´æ´»å‹•å ±è¡¨</button>
    </div>
    <div class="card">
        <h2>åƒåŠ è€…æ¸…å–® (é»æ“Š ğŸ”‘ ä¸€éµè®Šèº«ç™»å…¥)</h2>
        <table><thead><tr><th>ç…§ç‰‡</th><th>æš±ç¨±</th><th>æ‰‹æ©Ÿ</th><th>æ„Ÿæƒ…ç‹€æ…‹</th><th>æ¸¬è©¦</th></tr></thead><tbody id="ub"></tbody></table>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    const cfg = { apiKey: "AIzaSyDv4EOEmJ8dfWgZEv5mYtaiXuzbwgjMAUA", authDomain: "jariah-match.firebaseapp.com", projectId: "jariah-match", storageBucket: "jariah-match.firebasestorage.app", messagingSenderId: "863372390147", appId: "1:863372390147:web:7541b1b478c33f3d824336" };
    const app = initializeApp(cfg); const db = getFirestore(app);

    async function load() {
        const snap = await getDocs(query(collection(db, "users"), orderBy("createdAt", "desc")));
        const ub = document.getElementById('ub');
        window.allUsers = [];
        snap.forEach(doc => {
            const u = doc.data();
            window.allUsers.push({æš±ç¨±: u.name, æ‰‹æ©Ÿ: u.phone, æ„Ÿæƒ…ç‹€æ…‹: u.stat, è‡ªæˆ‘èªåŒ: u.ident});
            const imgs = u.photos ? u.photos.filter(p=>p).map(p=>`<img src="${p}" class="thumb">`).join('') : 'ğŸ‘¤';
            ub.innerHTML += `<tr><td>${imgs}</td><td><b>${u.name}</b></td><td>${u.phone}</td><td>${u.stat||'--'}</td><td><button onclick="window.open('index.html?u=${u.name}')">ğŸ”‘</button></td></tr>`;
        });
    }
    window.exportExcel = () => {
        const ws = XLSX.utils.json_to_sheet(window.allUsers);
        const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, "åå†Š");
        XLSX.writeFile(wb, "æ´»å‹•è³‡æ–™.xlsx");
    };
    load();
</script>
</body>
</html>
