<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœˆéœé…’å§ - æœˆè€æˆ°æƒ…å®¤</title>
    <style>
        body { font-family: 'PingFang TC', sans-serif; background-color: #f4f4f4; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        header { display: flex; align-items: center; border-bottom: 3px solid #E64A19; padding-bottom: 20px; margin-bottom: 20px; }
        .logo { width: 60px; height: 60px; border-radius: 50%; border: 3px solid #E64A19; margin-right: 20px; object-fit: cover; }
        h1 { margin: 0; color: #E64A19; font-size: 24px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: center; }
        th { background-color: #FFF3E0; color: #E64A19; font-weight: bold; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        
        /* ç‹€æ…‹æ¨£å¼ */
        .status-match { background-color: #C8E6C9 !important; color: #2E7D32; font-weight: bold; } /* æˆåŠŸé…å° */
        .status-wait { color: #999; } /* ç­‰å¾…ä¸­ */
        .status-skip { color: #F44336; } /* æœ‰ä¸€æ–¹ç•¥é */
        
        .score-box { display: inline-block; width: 30px; height: 30px; line-height: 30px; border-radius: 50%; background: #eee; font-weight: bold; }
        .score-high { background: #FFCC80; color: #E64A19; }
        
        .refresh-btn { float: right; padding: 10px 20px; background: #E64A19; color: white; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <button class="refresh-btn" onclick="location.reload()">ğŸ”„ åˆ·æ–°æ•¸æ“š</button>
    <header>
        <img src="staff_old_man.jpg" alt="Logo" class="logo">
        <div>
            <h1>æœˆéœé…’å§é…å°å¾Œå°</h1>
            <p style="margin:5px 0 0 0; color:#888;">å³æ™‚ç›£æ§å…¨å ´å¿ƒæ„æµå‘</p>
        </div>
    </header>

    <table>
        <thead>
            <tr>
                <th>è§’è‰² A</th>
                <th>è§’è‰² B</th>
                <th>A çš„å¿ƒæ„</th>
                <th>B çš„å¿ƒæ„</th>
                <th>ç©åˆ†ç¸½å’Œ</th>
                <th>é…å°ç‹€æ…‹</th>
            </tr>
        </thead>
        <tbody id="data-body">
            <tr><td colspan="6">æ­£åœ¨é€£ç·šè‡³è³‡æ–™åº«...</td></tr>
        </tbody>
    </table>
</div>

<script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbzGGOXqSP0_De4InUp-xBGIux_CuCAS600ACuLE-UFLzlPkPrR_3U6QGCHJKIK1dbMV/exec';

    async function fetchData() {
        try {
            const res = await fetch(API_URL);
            const data = await res.json();
            const body = document.getElementById('data-body');
            body.innerHTML = '';

            if (data.adminStats.length === 0) {
                body.innerHTML = '<tr><td colspan="6">ç›®å‰é‚„æ²’æœ‰ä»»ä½•äº’å‹•ç´€éŒ„</td></tr>';
                return;
            }

            data.adminStats.forEach(item => {
                // è§£æç‹€æ…‹
                let statusHtml = '';
                let rowClass = '';
                
                // é‚è¼¯åˆ¤æ–·
                if (item.isMatch) {
                    // æˆåŠŸé…å° (é›™æ–¹çµ¦æ˜Ÿä¸”ç¸½åˆ†>5)
                    statusHtml = 'ğŸ’– é…å°æˆåŠŸ';
                    rowClass = 'status-match';
                } else if (item.s12 === 0 || item.s21 === 0) {
                    // æœ‰ä¸€æ–¹çµ¦äº† 0 åˆ† (ç•¥é)
                    statusHtml = '<span class="status-skip">ğŸ’” ç·£åˆ†æœªåˆ° (ç•¥é)</span>';
                } else if (item.s12 === -1 || item.s21 === -1) {
                    // æœ‰ä¸€æ–¹é‚„æ²’è©•åˆ† (-1)
                    statusHtml = '<span class="status-wait">â³ ç­‰å¾…å°æ–¹å›æ‡‰</span>';
                } else {
                    // é›™æ–¹éƒ½è©•äº†ï¼Œä½†ç¸½åˆ†æ²’è¶…é 5
                    statusHtml = '<span class="status-wait">ğŸ˜ æ„Ÿè¦ºä¸å¤ å¼·çƒˆ</span>';
                }

                // åˆ†æ•¸é¡¯ç¤ºå„ªåŒ– (-1 é¡¯ç¤ºç‚º ?)
                const showS12 = item.s12 === -1 ? '?' : item.s12;
                const showS21 = item.s21 === -1 ? '?' : item.s21;
                const showTotal = (item.s12 === -1 || item.s21 === -1) ? '-' : item.total;

                body.innerHTML += `
                    <tr class="${rowClass}">
                        <td><strong>${item.p1}</strong></td>
                        <td><strong>${item.p2}</strong></td>
                        <td><span class="score-box ${item.s12>=4?'score-high':''}">${showS12}</span></td>
                        <td><span class="score-box ${item.s21>=4?'score-high':''}">${showS21}</span></td>
                        <td style="font-weight:bold; font-size:16px;">${showTotal}</td>
                        <td>${statusHtml}</td>
                    </tr>
                `;
            });

        } catch (e) {
            document.getElementById('data-body').innerHTML = '<tr><td colspan="6" style="color:red;">è®€å–å¤±æ•—ï¼Œè«‹ç¢ºèª Apps Script å·²éƒ¨ç½²ç‚ºæ–°ç‰ˆæœ¬ã€‚</td></tr>';
        }
    }

    fetchData();
    setInterval(fetchData, 10000); // æ¯ 10 ç§’è‡ªå‹•åˆ·æ–°ä¸€æ¬¡
</script>

</body>
</html>
